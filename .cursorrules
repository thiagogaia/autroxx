# Task Manager MVP - Cursor Rules

## ğŸ¯ VisÃ£o Geral do Projeto
Este Ã© um sistema de gerenciamento de tarefas (Task Manager) desenvolvido em Next.js (shadcn ui) com foco em:
- **Offline-first**: Funciona sem conexÃ£o com internet
- **GamificaÃ§Ã£o**: Sistema de pontuaÃ§Ã£o, conquistas e nÃ­veis
- **IndexedDB**: Armazenamento local robusto com sincronizaÃ§Ã£o posterior
- **Filtros AvanÃ§ados**: Sistema completo de filtros, paginaÃ§Ã£o e ordenaÃ§Ã£o

## ğŸ—ï¸ Arquitetura e PadrÃµes

### Repository Pattern
- **SEMPRE** use o padrÃ£o Repository para acesso a dados
- **NUNCA** acesse IndexedDB diretamente nos componentes
- Use `IndexedDBTaskRepository` como implementaÃ§Ã£o principal
- Mantenha compatibilidade com `ITaskRepository` interface

### Specification/Query Object Pattern
- Use `TaskFilters` para filtros complexos
- Implemente `PaginationParams` para paginaÃ§Ã£o
- Mantenha separaÃ§Ã£o entre lÃ³gica de consulta e implementaÃ§Ã£o

## ğŸ“‹ Regras de NegÃ³cio - Task (Tarefa)

### Status da Tarefa
```typescript
type TaskStatus = 'a_fazer' | 'fazendo' | 'concluido';
```

**REGRAS CRÃTICAS:**
- âœ… **dataInicio**: Definida APENAS quando status muda para 'fazendo' (se ainda nÃ£o foi definida)
- âœ… **dataFim**: Definida APENAS quando status muda para 'concluido'
- âœ… **statusHistorico**: SEMPRE adicionar entrada quando status muda
- âœ… **NUNCA** altere status automaticamente ao marcar/desmarcar impedimento

### Prioridade da Tarefa
```typescript
type TaskPriority = 'baixa' | 'normal' | 'media' | 'alta';
```

**REGRAS CRÃTICAS:**
- âœ… **numeroMudancasPrioridade**: Incrementar SEMPRE que prioridade muda
- âœ… **NUNCA** permita prioridade undefined - use 'normal' como padrÃ£o

### Impedimentos
```typescript
interface ImpedimentoHistoryEntry {
  id: string;           // ID Ãºnico (timestamp + random)
  impedimento: boolean;  // true = marcado, false = desmarcado
  motivo: string;        // Motivo do impedimento
  timestamp: Date;       // Quando foi marcado/desmarcado
}
```

**REGRAS CRÃTICAS:**
- âœ… **NUNCA** altere statusAtual quando marca/desmarca impedimento
- âœ… **NUNCA** adicione entrada ao statusHistorico para impedimentos
- âœ… **SEMPRE** use impedimentoHistorico para histÃ³rico de impedimentos
- âœ… **dataImpedimento**: Definida quando impede=true, null quando impede=false

### Campos Opcionais
```typescript
// Campos que podem ser undefined - SEMPRE tratar
estimativaTempo?: number;           // Use undefined, nÃ£o null
categoria?: TaskCategory;          // Use 'sem_categoria' como padrÃ£o
numeroMudancasPrioridade?: number; // Use || 0 para cÃ¡lculos
tempoTotalImpedimento?: number;    // Use || 0 para cÃ¡lculos
```

## ğŸ® Sistema de GamificaÃ§Ã£o

### PontuaÃ§Ã£o XP (Experience Points)
- âœ… **Base**: 100 XP por tarefa concluÃ­da
- âœ… **Complexidade**: Simples (+0), MÃ©dia (+50), Complexa (+100)
- âœ… **Categoria**: Desenvolvimento (+25), Bug (+75), DocumentaÃ§Ã£o (+50)
- âœ… **EficiÃªncia**: Dentro da estimativa (+100), 20% abaixo (+150)
- âœ… **Streak**: +25 XP por dia consecutivo

### Pontos de Qualidade (QP)
- âœ… **Zero impedimentos/semana**: +200 QP
- âœ… **Estimativas precisas (90-110%)**: +100 QP
- âœ… **Sem mudanÃ§as de prioridade**: +50 QP
- âœ… **Tempo de fila < 1 dia**: +75 QP

### NÃ­veis
```typescript
type UserLevel = 'novato' | 'desenvolvedor' | 'especialista' | 'mestre' | 'lenda';
```
- ğŸ¥‰ **Novato**: 0-1,000 XP
- ğŸ¥ˆ **Desenvolvedor**: 1,001-5,000 XP
- ğŸ¥‡ **Especialista**: 5,001-15,000 XP
- ğŸ’ **Mestre**: 15,001-30,000 XP
- ğŸ† **Lenda**: 30,001+ XP

## ğŸ” Sistema de Filtros

### Filtros BÃ¡sicos (FilterType)
```typescript
type FilterType = 'tudo' | 'a_fazer' | 'fazendo' | 'concluido' | 'normal' | 'urgente';
```

**REGRAS CRÃTICAS:**
- âœ… **'normal'**: Filtra por prioridade='normal' AND statusAtual!='concluido'
- âœ… **'urgente'**: Filtra por prioridade='alta' AND statusAtual!='concluido'
- âœ… **Outros**: Filtram diretamente por statusAtual

### Filtros AvanÃ§ados (TaskFilters)
```typescript
interface TaskFilters {
  statusFilter: FilterType;
  titleSearch?: string;
  dateRange?: { start: Date | null; end: Date | null };
  priorityFilter?: TaskPriority[];
  categoryFilter?: TaskCategory[];
  tagsFilter?: string[];
  impedimentFilter?: boolean | null; // null=todos, true=com impedimento, false=sem impedimento
  complexityFilter?: TaskComplexity[];
  sortBy?: 'dataCadastro' | 'titulo' | 'prioridade' | 'dataInicio' | 'dataFim';
  sortOrder?: 'asc' | 'desc';
}
```

## ğŸ’¾ Armazenamento e SincronizaÃ§Ã£o

### IndexedDB (Principal)
- âœ… **SEMPRE** use IndexedDB como storage principal
- âœ… **NUNCA** mantenha compatibilidade com localStorage
- âœ… **Offline-first**: Todas as operaÃ§Ãµes funcionam offline
- âœ… **Sync posterior**: SincronizaÃ§Ã£o quando online

### Metadados de SincronizaÃ§Ã£o
```typescript
interface SyncMetadata {
  id: string;
  lastModified: Date;
  isSynced: boolean;
  syncVersion: number;
  conflictResolution?: 'local' | 'remote' | 'manual';
}
```

### Fila de SincronizaÃ§Ã£o
- âœ… **OperaÃ§Ãµes**: 'create' | 'update' | 'delete'
- âœ… **Retry**: MÃ¡ximo 3 tentativas com backoff exponencial
- âœ… **Timestamp**: Para resoluÃ§Ã£o de conflitos

## ğŸš« Regras de ProibiÃ§Ã£o

### NUNCA FAÃ‡A:
- âŒ Alterar statusAtual ao marcar/desmarcar impedimento
- âŒ Adicionar entrada ao statusHistorico para impedimentos
- âŒ Usar localStorage (apenas IndexedDB)
- âŒ Criar regras de negÃ³cio nÃ£o documentadas
- âŒ Misturar tipos de histÃ³rico (status vs impedimento)
- âŒ Usar null para campos opcionais (use undefined)
- âŒ Sobrescrever regras de gamificaÃ§Ã£o existentes
- âŒ Criar novos tipos sem atualizar este arquivo
- âŒ Criar toasts customizados (use Sonner)
- âŒ Usar alert() ou confirm() (use toast + dialogs)

### SEMPRE FAÃ‡A:
- âœ… Use `TaskContextV2` como contexto principal
- âœ… Implemente validaÃ§Ãµes de tipo TypeScript
- âœ… Mantenha separaÃ§Ã£o entre status e impedimentos
- âœ… Use IDs Ãºnicos para histÃ³rico (timestamp + random)
- âœ… Trate campos opcionais com valores padrÃ£o
- âœ… Implemente retry para operaÃ§Ãµes de sincronizaÃ§Ã£o
- âœ… Mantenha logs para debugging (remova em produÃ§Ã£o)
- âœ… Use Sonner para todas as notificaÃ§Ãµes toast
- âœ… Use toast.success(), toast.error(), toast.info(), toast.warning()

## ğŸ”§ PadrÃµes de CÃ³digo

### Context e Reducer
```typescript
// SEMPRE use este padrÃ£o para actions
type TaskAction = 
  | { type: 'UPDATE_STATUS'; payload: { id: number; status: TaskStatus } }
  | { type: 'SET_IMPEDIMENT'; payload: { id: number; motivo: string } }
  | { type: 'REMOVE_IMPEDIMENT'; payload: { id: number } };
```

### Tratamento de Erros
```typescript
// SEMPRE trate erros de IndexedDB
try {
  await indexedDBRepository.update(id, task);
} catch (error) {
  console.error('Error updating task:', error);
  // Implementar fallback ou notificar usuÃ¡rio
}
```

### ValidaÃ§Ã£o de Tipos
```typescript
// SEMPRE valide tipos antes de usar
const task = tasks.find(t => t.id === id);
if (!task) {
  throw new Error(`Task with id ${id} not found`);
}
```

### Toast Notifications
```typescript
// SEMPRE use Sonner para toast notifications
import { toast } from 'sonner';

// Para sucesso
toast.success('OperaÃ§Ã£o realizada com sucesso!');

// Para erro
toast.error('Erro ao processar operaÃ§Ã£o');

// Para informaÃ§Ãµes
toast.info('InformaÃ§Ã£o importante');

// Para avisos
toast.warning('AtenÃ§Ã£o: aÃ§Ã£o requerida');
```

**REGRAS CRÃTICAS:**
- âœ… **SEMPRE** use `toast` do Sonner (jÃ¡ configurado no projeto)
- âœ… **NUNCA** crie toasts customizados ou use outras bibliotecas
- âœ… **NUNCA** use alert() ou confirm() - use toast + dialogs
- âœ… **SEMPRE** importe `{ toast } from 'sonner'`

## ğŸ“š DocumentaÃ§Ã£o
- âœ… **SEMPRE** atualize este arquivo quando adicionar novas regras
- âœ… **SEMPRE** documente novos tipos e interfaces
- âœ… **SEMPRE** explique regras de negÃ³cio complexas
- âœ… **SEMPRE** mantenha exemplos de cÃ³digo atualizados

## ğŸ¯ Objetivos do Sistema
1. **Produtividade**: Facilitar gestÃ£o eficiente de tarefas
2. **GamificaÃ§Ã£o**: Motivar atravÃ©s de conquistas e nÃ­veis
3. **Offline-first**: Funcionar sem conexÃ£o
4. **Escalabilidade**: Suportar grandes volumes de dados
5. **Manutenibilidade**: CÃ³digo limpo e bem documentado

---
**Ãšltima atualizaÃ§Ã£o**: 21/09/2025 17:45
**VersÃ£o**: 1.1.0
